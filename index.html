<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>모임 일정 및 공지사항</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: #fbfbfd;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #1d1d1f;
      line-height: 1.47059;
      font-weight: 400;
      letter-spacing: -0.022em;
    }
    .container {
      max-width: 748px;
      margin: 48px auto;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 40px 32px 32px 32px;
      position: relative;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #1d1d1f;
      font-size: 2.5rem;
      margin-bottom: 32px;
      letter-spacing: -0.003em;
      font-weight: 600;
      line-height: 1.1;
    }
    section {
      margin-bottom: 40px;
    }
    h2 {
      color: #1d1d1f;
      border-bottom: none;
      padding-bottom: 0;
      font-size: 1.5rem;
      margin-bottom: 20px;
      letter-spacing: -0.003em;
      font-weight: 600;
      line-height: 1.21053;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      background: rgba(255, 255, 255, 0.8);
      margin-bottom: 12px;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1rem;
      color: #1d1d1f;
      transition: all 0.2s ease;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    li:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    li:last-child {
      margin-bottom: 0;
    }
    .calendar-section, .notice-section {
      margin-bottom: 32px;
    }
    .calendar-inputs, .notice-inputs {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .calendar-inputs input[type="text"], .notice-inputs input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.2s ease;
      font-family: inherit;
    }
    .calendar-inputs input[type="text"]:focus, .notice-inputs input[type="text"]:focus {
      border: 1px solid #007aff;
      outline: none;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    .calendar-inputs button, .notice-inputs button {
      padding: 12px 24px;
      background: #007aff;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      letter-spacing: -0.022em;
    }
    .calendar-inputs button:hover, .notice-inputs button:hover {
      background: #0056d6;
      transform: translateY(-1px);
    }
    .gcal-btn {
      margin-left: 12px;
      padding: 8px 16px;
      font-size: 0.9rem;
      background: #34c759;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      letter-spacing: -0.022em;
    }
    .gcal-btn:hover {
      background: #28a745;
      transform: translateY(-1px);
    }
    li button {
      margin-left: 12px;
      padding: 8px 16px;
      font-size: 0.9rem;
      background: #ff3b30;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      letter-spacing: -0.022em;
    }
    li button:hover {
      background: #dc3545;
      transform: translateY(-1px);
    }
    @media (max-width: 600px) {
      .container {
        max-width: 100vw;
        padding: 20px 16px;
        margin: 0;
        border-radius: 0;
        box-shadow: none;
        border: none;
        background: rgba(255, 255, 255, 0.95);
      }
      h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
        line-height: 1.2;
      }
      h2 {
        font-size: 1.2rem;
        margin-bottom: 12px;
        line-height: 1.3;
      }
      .calendar-inputs, .notice-inputs {
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
      }
      .calendar-inputs input[type="text"], .notice-inputs input[type="text"] {
        font-size: 16px;
        padding: 12px 16px;
        border-radius: 8px;
        width: 100%;
        box-sizing: border-box;
      }
      .calendar-inputs button, .notice-inputs button {
        width: 100%;
        font-size: 16px;
        padding: 12px 0;
        margin-left: 0 !important;
        margin-top: 4px;
        border-radius: 8px;
      }
      li {
        flex-direction: column;
        align-items: flex-start;
        padding: 12px 16px;
        font-size: 14px;
        line-height: 1.4;
        margin-bottom: 8px;
      }
      li button {
        margin-top: 8px;
        width: 100%;
        font-size: 14px;
        padding: 8px 0;
        border-radius: 6px;
      }
      .gcal-btn {
        margin-left: 0;
        margin-top: 8px;
        width: 100%;
        font-size: 14px;
        padding: 8px 0;
        border-radius: 6px;
      }
      section {
        margin-bottom: 24px;
      }
      .calendar-section, .notice-section {
        margin-bottom: 20px;
      }
    }
    @media (max-width: 480px) {
      .container {
        padding: 16px 12px;
      }
      h1 {
        font-size: 1.6rem;
        margin-bottom: 16px;
      }
      h2 {
        font-size: 1.1rem;
        margin-bottom: 10px;
      }
      li {
        padding: 10px 12px;
        font-size: 13px;
      }
      .calendar-inputs input[type="text"], .notice-inputs input[type="text"] {
        font-size: 16px;
        padding: 10px 12px;
      }
      .calendar-inputs button, .notice-inputs button {
        font-size: 16px;
        padding: 10px 0;
      }
      li button, .gcal-btn {
        font-size: 13px;
        padding: 6px 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>쉴드본부 오부장 모임 일정 및 공지사항</h1>
    <section class="calendar-section">
      <h2>모임 일정 등록</h2>
      <div class="calendar-inputs">
        <input id="calendar-date" type="text" placeholder="날짜 선택" readonly>
        <input id="event-title" type="text" placeholder="일정 제목 입력">
        <button id="add-event">추가</button>
      </div>
    </section>
    <section>
      <h2>모임 일정</h2>
      <ul id="event-list">
        <li>2024-06-10(월) 19:00 - 정기 모임 @ 카페봄봄 <button class="gcal-btn" data-title="정기 모임 @ 카페봄봄봄" data-date="2024-06-10T19:00" data-emails="">구글 캘린더로 초대</button></li>
        <li>2024-06-24(월) 19:00 - 영화 관람 모임 <button class="gcal-btn" data-title="영화 관람 모임" data-date="2024-06-24T19:00" data-emails="">구글 캘린더로 초대</button></li>
      </ul>
    </section>
    <section class="notice-section">
      <h2>공지사항 등록</h2>
      <div class="notice-inputs" style="display: flex; gap: 8px; margin-bottom: 12px;">
        <input id="notice-input" type="text" placeholder="공지사항 입력" style="flex:1; padding:6px; border:1px solid #ccc; border-radius:4px;">
        <button id="add-notice">추가</button>
      </div>
    </section>
    <section>
      <h2>공지사항</h2>
      <ul id="notice-list"></ul>
    </section>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // flatpickr 달력 초기화
    flatpickr("#calendar-date", {
      enableTime: true,
      dateFormat: "Y-m-d H:i",
      locale: "ko"
    });

    // 일정 추가 기능
    const addBtn = document.getElementById('add-event');
    const dateInput = document.getElementById('calendar-date');
    const titleInput = document.getElementById('event-title');
    const eventList = document.getElementById('event-list');

    function createGCalUrl(title, date, emails) {
      // 항상 포함할 기본 이메일 목록
      const defaultEmails = [
        'ujham@innored.co.kr',
        'kbsmj@innored.co.kr',
        'alexpark@innored.co.kr',
        'yir80@innored.co.kr',
        'wonmo@innored.co.kr',
        'c_18840ik7du6bairmlt8lulcg242ce@resource.calendar.google.com'  // Cannes 이노타워 5층 회의실
      ];
      // emails 입력값과 기본 이메일 합치기 (중복 제거)
      const inputEmails = emails.split(',').map(e => e.trim()).filter(e => e);
      const allEmails = Array.from(new Set([...defaultEmails, ...inputEmails])).join(',');
      // date: 'YYYY-MM-DD HH:mm' → 'YYYYMMDDTHHmm00Z' (UTC로 변환하지 않고 로컬 시간 사용)
      const [d, t] = date.split(' ');
      const start = d.replace(/-/g, '') + 'T' + t.replace(':', '') + '00';
      // 1시간 뒤로 종료시간 설정
      const [hour, min] = t.split(':');
      const endHour = String(Number(hour) + 1).padStart(2, '0');
      const end = d.replace(/-/g, '') + 'T' + endHour + min + '00';
      const details = '';
      const location = 'Cannes이노타워 5층';
      let url = `https://calendar.google.com/calendar/render?action=TEMPLATE`;
      url += `&text=${encodeURIComponent(title)}`;
      url += `&dates=${start}/${end}`;
      if (details) url += `&details=${encodeURIComponent(details)}`;
      if (location) url += `&location=${encodeURIComponent(location)}`;
      if (allEmails) url += `&add=${encodeURIComponent(allEmails)}`;
      url += `&sf=true&output=xml`;
      return url;
    }

    function addGCalBtn(li, title, date, emails) {
      const btn = document.createElement('button');
      btn.textContent = '구글 캘린더로 초대';
      btn.className = 'gcal-btn';
      btn.addEventListener('click', function() {
        const url = createGCalUrl(title, date, emails);
        window.open(url, '_blank');
      });
      li.appendChild(document.createTextNode(' '));
      li.appendChild(btn);
    }

    // 일정 저장/불러오기용 키
    const STORAGE_KEY = 'meeting_events';

    // 일정 렌더링 함수
    function renderEvents(events) {
      eventList.innerHTML = '';
      events.forEach((event, idx) => {
        const li = document.createElement('li');
        li.textContent = `${event.date} - ${event.title}`;
        addGCalBtn(li, event.title, event.date, event.emails);
        // 삭제 버튼
        const delBtn = document.createElement('button');
        delBtn.textContent = '삭제';
        delBtn.style.marginLeft = '8px';
        delBtn.addEventListener('click', function() {
          events.splice(idx, 1);
          saveEvents(events);
          renderEvents(events);
        });
        li.appendChild(delBtn);
        eventList.appendChild(li);
      });
    }

    // 일정 저장
    function saveEvents(events) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }
    // 일정 불러오기
    function loadEvents() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return [];
      try {
        return JSON.parse(data);
      } catch {
        return [];
      }
    }

    // 공지사항 저장/불러오기용 키
    const NOTICE_KEY = 'meeting_notices';
    const noticeInput = document.getElementById('notice-input');
    const addNoticeBtn = document.getElementById('add-notice');
    const noticeList = document.getElementById('notice-list');

    function promptPassword() {
      return prompt('공지사항을 등록/삭제하려면 비밀번호를 입력하세요:');
    }
    const NOTICE_PASSWORD = '3015';

    function renderNotices(notices) {
      noticeList.innerHTML = '';
      notices.forEach((notice, idx) => {
        const li = document.createElement('li');
        li.textContent = notice;
        // 삭제 버튼
        const delBtn = document.createElement('button');
        delBtn.textContent = '삭제';
        delBtn.style.marginLeft = '8px';
        delBtn.addEventListener('click', function() {
          const pw = promptPassword();
          if (pw !== NOTICE_PASSWORD) {
            alert('비밀번호가 올바르지 않습니다.');
            return;
          }
          notices.splice(idx, 1);
          saveNotices(notices);
          renderNotices(notices);
        });
        li.appendChild(delBtn);
        noticeList.appendChild(li);
      });
    }
    function saveNotices(notices) {
      localStorage.setItem(NOTICE_KEY, JSON.stringify(notices));
    }
    function loadNotices() {
      const data = localStorage.getItem(NOTICE_KEY);
      if (!data) return [];
      try {
        return JSON.parse(data);
      } catch {
        return [];
      }
    }

    // 초기 로드
    let events = loadEvents();
    renderEvents(events);

    addBtn.addEventListener('click', function() {
      const date = dateInput.value;
      const title = titleInput.value.trim();
      if (!date || !title) {
        alert('날짜와 일정을 모두 입력해 주세요.');
        return;
      }
      // 최대 5개만 유지 (최신 5개)
      if (events.length >= 5) {
        events.shift(); // 가장 오래된 것 삭제
      }
      events.push({ date, title, emails: '' });
      saveEvents(events);
      renderEvents(events);
      // 입력값 초기화
      dateInput.value = '';
      titleInput.value = '';
    });

    // 공지사항 추가 기능
    let notices = loadNotices();
    renderNotices(notices);

    addNoticeBtn.addEventListener('click', function() {
      const text = noticeInput.value.trim();
      if (!text) return;
      const pw = promptPassword();
      if (pw !== NOTICE_PASSWORD) {
        alert('비밀번호가 올바르지 않습니다.');
        return;
      }
      if (notices.length >= 3) {
        notices.shift(); // 가장 오래된 것 삭제
      }
      notices.push(text);
      saveNotices(notices);
      renderNotices(notices);
      noticeInput.value = '';
    });

    // 기존 일정의 구글 캘린더 버튼 동작 연결 제거 (LocalStorage 기반으로만 관리)
  </script>
</body>
</html>
